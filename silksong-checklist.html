<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hollow Knight: Silksong - 100% Completion Checklist</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        th {
            cursor: pointer;
            user-select: none;
        }
        .completed-row {
            opacity: 0.6;
            text-decoration: line-through;
        }
        .sticky-top {
            background-color: #fff;
            z-index: 1020;
        }

        /* Mobile-friendly styles */
        @media (max-width: 768px) {
            .desktop-table {
                display: none;
            }
            .mobile-cards {
                display: block;
            }
            .desktop-filters {
                display: none;
            }
            .mobile-filters {
                display: block;
            }
        }

        @media (min-width: 769px) {
            .desktop-table {
                display: block !important;
            }
            .mobile-cards {
                display: none !important;
            }
            .desktop-filters {
                display: block !important;
            }
            .mobile-filters {
                display: none !important;
            }
        }

        .mobile-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .mobile-card.completed {
            opacity: 0.6;
        }

        .mobile-card-header {
            display: flex;
            align-items: start;
            gap: 12px;
            margin-bottom: 8px;
        }

        .mobile-card-title {
            font-weight: 600;
            font-size: 1rem;
            flex: 1;
        }

        .mobile-card-body {
            font-size: 0.875rem;
            color: #666;
        }

        .mobile-card-footer {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4" x-data="checklistApp()">
        <div class="sticky-top pb-3 mb-3">
            <h1 class="text-center mb-3">Hollow Knight: Silksong - 100% Completion Checklist</h1>

            <!-- Progress Bar -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar"
                             role="progressbar"
                             :style="`width: ${progressPercentage}%`"
                             :aria-valuenow="progressPercentage"
                             aria-valuemin="0"
                             aria-valuemax="100">
                            <span x-text="`${completedCount} / ${totalItems} (${progressPercentage}%)`"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Filters -->
            <div class="mobile-filters mb-3">
                <div class="mb-2">
                    <div class="form-check form-switch">
                        <input class="form-check-input"
                               type="checkbox"
                               id="hideCompletedMobile"
                               x-model="hideCompleted">
                        <label class="form-check-label" for="hideCompletedMobile">
                            Hide Completed
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <input type="text"
                           class="form-control"
                           placeholder="Search..."
                           x-model="searchQuery">
                </div>
                <div class="row g-2 mb-2">
                    <div class="col-6">
                        <select class="form-select" x-model="filterType">
                            <option value="">All Types</option>
                            <option value="Boss">Bosses</option>
                            <option value="Mini-Boss">Mini-Bosses</option>
                            <option value="Red Tool">Red Tools</option>
                            <option value="Blue Tool">Blue Tools</option>
                            <option value="Yellow Tool">Yellow Tools</option>
                            <option value="Silk Skill">Silk Skills</option>
                            <option value="Crest">Crests</option>
                            <option value="Lost Flea">Lost Fleas</option>
                            <option value="Mister Mushroom">Mister Mushroom</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <select class="form-select" x-model="filterLocation">
                            <option value="">All Locations</option>
                            <template x-for="location in uniqueLocations" :key="location">
                                <option :value="location" x-text="location"></option>
                            </template>
                        </select>
                    </div>
                </div>
                <div class="row g-2 mb-2">
                    <div class="col-6">
                        <select class="form-select" x-model="filterAct">
                            <option value="">All Acts</option>
                            <template x-for="act in uniqueActs" :key="act">
                                <option :value="act" x-text="act"></option>
                            </template>
                        </select>
                    </div>
                    <div class="col-6">
                        <div class="border rounded p-2" style="max-height: 150px; overflow-y: auto;">
                            <div class="fw-bold mb-1" style="font-size: 0.875rem;">Abilities I Have:</div>
                            <template x-for="prereq in uniquePrerequisites" :key="prereq">
                                <div class="form-check" style="font-size: 0.875rem;">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           :id="'mobile-prereq-' + prereq"
                                           :value="prereq"
                                           x-model="filterPrerequisites"
                                           @change="saveToLocalStorage()">
                                    <label class="form-check-label" :for="'mobile-prereq-' + prereq" x-text="prereq"></label>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="btn-group w-100" role="group">
                        <button class="btn btn-success btn-sm" @click="exportData()">Export</button>
                        <button class="btn btn-info btn-sm" @click="$refs.importFile.click()">Import</button>
                        <button class="btn btn-warning btn-sm" @click="resetAll()">Reset</button>
                    </div>
                    <input type="file"
                           x-ref="importFile"
                           @change="importData($event)"
                           accept=".json"
                           style="display: none;">
                </div>
            </div>

            <!-- Desktop Filters -->
            <div class="desktop-filters mb-3">
                <div class="d-flex gap-2 mb-2">
                    <div style="width: 50px;">
                        <div class="form-check form-switch" style="padding-top: 8px;">
                            <input class="form-check-input"
                                   type="checkbox"
                                   id="hideCompleted"
                                   x-model="hideCompleted"
                                   title="Hide Completed Items">
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <input type="text"
                               class="form-control form-control-sm"
                               placeholder="Search name or description..."
                               x-model="searchQuery">
                    </div>
                    <div style="width: 130px;">
                        <select class="form-select form-select-sm" x-model="filterType">
                            <option value="">All Types</option>
                            <option value="Boss">Bosses</option>
                            <option value="Mini-Boss">Mini-Bosses</option>
                            <option value="Red Tool">Red Tools</option>
                            <option value="Blue Tool">Blue Tools</option>
                            <option value="Yellow Tool">Yellow Tools</option>
                            <option value="Silk Skill">Silk Skills</option>
                            <option value="Crest">Crests</option>
                            <option value="Lost Flea">Lost Fleas</option>
                            <option value="Mister Mushroom">Mister Mushroom</option>
                        </select>
                    </div>
                    <div style="width: 170px;">
                        <select class="form-select form-select-sm" x-model="filterLocation">
                            <option value="">All Locations</option>
                            <template x-for="location in uniqueLocations" :key="location">
                                <option :value="location" x-text="location"></option>
                            </template>
                        </select>
                    </div>
                    <div style="width: 100px;">
                        <select class="form-select form-select-sm" x-model="filterAct">
                            <option value="">All Acts</option>
                            <template x-for="act in uniqueActs" :key="act">
                                <option :value="act" x-text="act"></option>
                            </template>
                        </select>
                    </div>
                    <div style="width: 180px;">
                        <div class="border rounded p-2" style="max-height: 120px; overflow-y: auto; background: white;">
                            <div class="fw-bold mb-1" style="font-size: 0.75rem;">Abilities I Have:</div>
                            <template x-for="prereq in uniquePrerequisites" :key="prereq">
                                <div class="form-check" style="font-size: 0.75rem;">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           :id="'desktop-prereq-' + prereq"
                                           :value="prereq"
                                           x-model="filterPrerequisites"
                                           @change="saveToLocalStorage()">
                                    <label class="form-check-label" :for="'desktop-prereq-' + prereq" x-text="prereq"></label>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div style="width: 180px;">
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-success btn-sm" @click="exportData()">Export</button>
                            <button class="btn btn-info btn-sm" @click="$refs.importFile.click()">Import</button>
                            <button class="btn btn-warning btn-sm" @click="resetAll()">Reset</button>
                        </div>
                        <input type="file"
                               x-ref="importFile"
                               @change="importData($event)"
                               accept=".json"
                               style="display: none;">
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Table -->
        <div class="desktop-table table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th style="width: 50px;"></th>
                        <th @click="sortBy('name')">
                            Name <span x-show="sortField === 'name'" x-text="sortDirection === 'asc' ? '↑' : '↓'"></span>
                        </th>
                        <th>Description</th>
                        <th style="width: 130px;" @click="sortBy('type')">
                            Type <span x-show="sortField === 'type'" x-text="sortDirection === 'asc' ? '↑' : '↓'"></span>
                        </th>
                        <th style="width: 170px;" @click="sortBy('location')">
                            Location <span x-show="sortField === 'location'" x-text="sortDirection === 'asc' ? '↑' : '↓'"></span>
                        </th>
                        <th style="width: 100px;" @click="sortBy('act')">
                            Act <span x-show="sortField === 'act'" x-text="sortDirection === 'asc' ? '↑' : '↓'"></span>
                        </th>
                        <th style="width: 180px;">Prerequisites</th>
                        <th style="width: 180px;">Links</th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="item in filteredItems" :key="item.id">
                        <tr :class="{ 'completed-row': item.completed }">
                            <td>
                                <input type="checkbox"
                                       class="form-check-input"
                                       :checked="item.completed"
                                       @change="toggleItem(item.id, $event.target.checked)">
                            </td>
                            <td x-text="item.name"></td>
                            <td x-text="item.description"></td>
                            <td><span class="badge bg-secondary" x-text="item.type"></span></td>
                            <td x-text="item.location"></td>
                            <td x-text="item.act"></td>
                            <td x-text="item.prerequisites ? item.prerequisites.join(', ') : ''"></td>
                            <td>
                                <a :href="item.wikiUrl" target="_blank" class="btn btn-sm btn-outline-primary me-1">Wiki</a>
                                <a :href="item.mapUrl" target="_blank" class="btn btn-sm btn-outline-info">Map</a>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>

        <!-- Mobile Cards -->
        <div class="mobile-cards">
            <template x-for="item in filteredItems" :key="item.id">
                <div class="mobile-card" :class="{ 'completed': item.completed }">
                    <div class="mobile-card-header">
                        <input type="checkbox"
                               class="form-check-input"
                               style="margin-top: 4px;"
                               :checked="item.completed"
                               @change="toggleItem(item.id, $event.target.checked)">
                        <div class="flex-fill">
                            <div class="mobile-card-title" x-text="item.name"></div>
                            <div class="mobile-card-body">
                                <div><span class="badge bg-secondary" x-text="item.type"></span></div>
                                <div class="mt-1"><strong>Location:</strong> <span x-text="item.location"></span></div>
                                <div class="mt-1"><strong>Act:</strong> <span x-text="item.act"></span></div>
                                <div class="mt-1" x-show="item.prerequisites && item.prerequisites.length"><strong>Prerequisites:</strong> <span x-text="item.prerequisites.join(', ')"></span></div>
                                <div class="mt-1" x-show="item.description" x-text="item.description"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mobile-card-footer">
                        <a :href="item.wikiUrl" target="_blank" class="btn btn-sm btn-outline-primary">Wiki</a>
                        <a :href="item.mapUrl" target="_blank" class="btn btn-sm btn-outline-info">Map</a>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
        function checklistApp() {
            return {
                searchQuery: '',
                filterType: '',
                filterLocation: '',
                filterAct: '',
                filterPrerequisites: [],
                hideCompleted: false,
                sortField: 'type',
                sortDirection: 'asc',
                items: [{"id":1,"name":"Widow","type":"Boss","location":"Bellhart","description":"","act":"Act 1","prerequisites":["Drifter's Cloak"]},{"id":2,"name":"Groal The Great","type":"Boss","location":"Bilewater","description":"","act":"Acts 2-3","prerequisites":[]},{"id":3,"name":"Phantom","type":"Boss","location":"Bilewater","description":"","act":"Act 1","prerequisites":["Needolin"]},{"id":4,"name":"Great Conchflies","type":"Boss","location":"Blasted Steps","description":"","act":"Act 2","prerequisites":[]},{"id":5,"name":"Last Judge","type":"Boss","location":"Blasted Steps","description":"","act":"Act 1","prerequisites":[]},{"id":6,"name":"Lost Garmond","type":"Boss","location":"Blasted Steps","description":"","act":"Act 3","prerequisites":[]},{"id":7,"name":"Cogwork Dancers","type":"Boss","location":"Cogwork Core","description":"","act":"Act 2","prerequisites":[]},{"id":8,"name":"Forebrothers Signis and Gron","type":"Boss","location":"Deep Docks","description":"","act":"Act 2","prerequisites":[]},{"id":9,"name":"Lace","type":"Boss","location":"Deep Docks","description":"","act":"Acts 1-2","prerequisites":[]},{"id":10,"name":"Fourth Chorus","type":"Boss","location":"Far Fields","description":"","act":"Act 1","prerequisites":["Drifter's Cloak"]},{"id":11,"name":"Gurr the Outcast","type":"Boss","location":"Far Fields","description":"","act":"Act 3","prerequisites":["Clawline","Faydown Cloak"]},{"id":12,"name":"Lost Skarrgard","type":"Boss","location":"Far Fields","description":"","act":"Act 3","prerequisites":[]},{"id":13,"name":"Savage Beastfly","type":"Boss","location":"Far Fields","description":"","act":"Act 1","prerequisites":[]},{"id":14,"name":"Skarrsinger Karmelita","type":"Boss","location":"Far Fields","description":"","act":"Act 3","prerequisites":["Silk Soar"]},{"id":15,"name":"Crawfather","type":"Boss","location":"Greymoor","description":"","act":"","prerequisites":[]},{"id":16,"name":"Moorwing","type":"Boss","location":"Greymoor","description":"","act":"Acts 1-2","prerequisites":[]},{"id":17,"name":"Shakra","type":"Boss","location":"Greymoor","description":"","act":"Acts 1-2","prerequisites":[]},{"id":18,"name":"Second Sentinel","type":"Boss","location":"High Halls","description":"","act":"Act 3","prerequisites":[]},{"id":19,"name":"Lost Moss Mother","type":"Boss","location":"Moss Grotto","description":"","act":"Act 3","prerequisites":[]},{"id":20,"name":"Moss Mother","type":"Boss","location":"Moss Grotto","description":"","act":"Act 1","prerequisites":[]},{"id":21,"name":"Summoned Saviour","type":"Boss","location":"Moss Grotto","description":"Steel Soul Mode only","act":"","prerequisites":[]},{"id":22,"name":"Pinstress","type":"Boss","location":"Mount Fay","description":"","act":"","prerequisites":[]},{"id":23,"name":"Crust King Khann","type":"Boss","location":"Sands of Karak","description":"","act":"Act 3","prerequisites":[]},{"id":24,"name":"Raging Conchfly","type":"Boss","location":"Sands of Karak","description":"","act":"Acts 2-3","prerequisites":[]},{"id":25,"name":"Voltvyrm","type":"Boss","location":"Sands of Karak","description":"","act":"Act 3","prerequisites":["Silk Soar"]},{"id":26,"name":"Watcher at the Edge","type":"Boss","location":"Sands of Karak","description":"","act":"Act 3","prerequisites":["Needolin"]},{"id":27,"name":"Nyleth","type":"Boss","location":"Shellwood","description":"","act":"Act 3","prerequisites":["Silk Soar"]},{"id":28,"name":"Seth","type":"Boss","location":"Shellwood","description":"","act":"Act 3","prerequisites":["Silk Soar"]},{"id":29,"name":"Sister Splinter","type":"Boss","location":"Shellwood","description":"","act":"Act 1","prerequisites":[]},{"id":30,"name":"Disgraced Chef Lugoli","type":"Boss","location":"Sinner's Road","description":"","act":"Act 2","prerequisites":["Clawline","Faydown Cloak"]},{"id":31,"name":"Lost Lace","type":"Boss","location":"The Abyss","description":"","act":"Act 3","prerequisites":[]},{"id":32,"name":"Grand Mother Silk","type":"Boss","location":"The Cradle","description":"","act":"Act 2","prerequisites":[]},{"id":33,"name":"Lace","type":"Boss","location":"The Cradle","description":"","act":"Acts 1-2","prerequisites":[]},{"id":34,"name":"Bell Beast","type":"Boss","location":"The Marrow","description":"","act":"Act 1","prerequisites":[]},{"id":35,"name":"Skarrgard","type":"Boss","location":"The Marrow","description":"","act":"Acts 1-3","prerequisites":[]},{"id":36,"name":"Skull Tyrant","type":"Boss","location":"The Marrow","description":"","act":"Act 1","prerequisites":[]},{"id":37,"name":"Broodmother","type":"Boss","location":"The Slab","description":"","act":"Act 2","prerequisites":[]},{"id":38,"name":"First Sinner","type":"Boss","location":"The Slab","description":"","act":"Acts 2-3","prerequisites":[]},{"id":39,"name":"Clover Dancers","type":"Boss","location":"Verdania","description":"","act":"Act 3","prerequisites":[]},{"id":40,"name":"Palestag","type":"Boss","location":"Verdania","description":"","act":"Act 3","prerequisites":[]},{"id":41,"name":"Garmond and Zaza","type":"Boss","location":"Whispering Vaults","description":"","act":"Acts 1-3","prerequisites":[]},{"id":42,"name":"Tormented Trobbio","type":"Boss","location":"Whispering Vaults","description":"","act":"Act 3","prerequisites":[]},{"id":43,"name":"Trobbio","type":"Boss","location":"Whispering Vaults","description":"","act":"Act 2","prerequisites":[]},{"id":44,"name":"Father of the Flame","type":"Boss","location":"Wisp Thicket","description":"","act":"Act 2","prerequisites":["Faydown Cloak"]},{"id":45,"name":"The Unravelled","type":"Boss","location":"Whiteward","description":"","act":"Act 2","prerequisites":["Clawline"]},{"id":46,"name":"Plasmified Zango","type":"Boss","location":"Wormways","description":"","act":"Act 3","prerequisites":[]},{"id":47,"name":"Rhinogrund","type":"Boss","location":"Far Fields","description":"","act":"Acts 1-2","prerequisites":[]},{"id":48,"name":"Choir Clapper","type":"Mini-Boss","location":"High Halls","description":"","act":"","prerequisites":[]},{"id":49,"name":"Craggler","type":"Mini-Boss","location":"Wormways","description":"","act":"","prerequisites":[]},{"id":50,"name":"Rhinogrund","type":"Mini-Boss","location":"Memorium","description":"","act":"Acts 1-2","prerequisites":[]},{"id":51,"name":"Skarrgard","type":"Mini-Boss","location":"The Marrow","description":"","act":"Acts 1-3","prerequisites":[]},{"id":52,"name":"Straight Pin","type":"Red Tool","location":"The Marrow","description":"Prison cell east of area","act":"Act 1","prerequisites":[]},{"id":53,"name":"Threefold Pin","type":"Red Tool","location":"Greymoor","description":"Guarded by Tallcraw in Craw Lake","act":"Act 1","prerequisites":[]},{"id":54,"name":"Sting Shard","type":"Red Tool","location":"Deep Docks","description":"Purchase from Forge Daughter (140 Rosaries + Craftmetal)","act":"Act 1","prerequisites":[]},{"id":55,"name":"Curveclaw","type":"Red Tool","location":"Hunter's March","description":"Buy from Mottled Skarr (140 Rosaries)","act":"Act 1","prerequisites":[]},{"id":56,"name":"Longpin","type":"Red Tool","location":"Bellhart","description":"Destroy Wood Wasp nest on right side","act":"Act 1","prerequisites":[]},{"id":57,"name":"Tacks","type":"Red Tool","location":"Sinner's Road","description":"Reward for Roach Guts wish","act":"Act 1","prerequisites":[]},{"id":58,"name":"Curvesickle","type":"Red Tool","location":"Far Fields","description":"Give Curveclaw to Skarr Scout (Act 3)","act":"Act 3","prerequisites":[]},{"id":59,"name":"Throwing Ring","type":"Red Tool","location":"Bilewater","description":"Complete Trail's End wish","act":"Act 1","prerequisites":[]},{"id":60,"name":"Pimpillo","type":"Red Tool","location":"Greymoor","description":"Requires Cling Grip, craft at table","act":"Act 1","prerequisites":["Cling Grip"]},{"id":61,"name":"Silkshot (Twelfth Architect)","type":"Red Tool","location":"Underworks","description":"Repair Ruined Tool (130 Rosaries + Craftmetal)","act":"Act 1","prerequisites":[]},{"id":62,"name":"Silkshot (Forge Daughter)","type":"Red Tool","location":"Deep Docks","description":"Repair Ruined Tool (240 Rosaries + Craftmetal)","act":"Act 1","prerequisites":[]},{"id":63,"name":"Conchcutter","type":"Red Tool","location":"Sands of Karak","description":"Coral Tower - end of east path","act":"Act 1","prerequisites":[]},{"id":64,"name":"Silkshot","type":"Red Tool","location":"Mount Fay","description":"Repair at peak (1 Craftmetal)","act":"Act 1","prerequisites":[]},{"id":65,"name":"Delver's Drill","type":"Red Tool","location":"Underworks","description":"Hazardous tunnel near bench","act":"Act 1","prerequisites":[]},{"id":66,"name":"Cogwork Wheel","type":"Red Tool","location":"Cogwork Core","description":"Buy from Twelfth Architect (360 Rosaries + Craftmetal)","act":"Act 1","prerequisites":[]},{"id":67,"name":"Snare Setter","type":"Red Tool","location":"Moss Grotto","description":"Secret room (requires Faydown Cloak, Cling Grip)","act":"Act 1","prerequisites":["Faydown Cloak","Cling Grip"]},{"id":68,"name":"Flintslate","type":"Red Tool","location":"Deep Docks","description":"Passage east of Forge Daughter","act":"Act 1","prerequisites":[]},{"id":69,"name":"Cogfly","type":"Red Tool","location":"High Halls","description":"Craft at table (1 Craftmetal)","act":"Act 1","prerequisites":[]},{"id":70,"name":"Needle Phial","type":"Red Tool","location":"Wormways","description":"From Alchemist Zylotol quest","act":"Act 1","prerequisites":[]},{"id":71,"name":"Flea Brew","type":"Red Tool","location":"Greymoor","description":"Reward from Grishkin (Lost Fleas quest)","act":"Act 1","prerequisites":[]},{"id":72,"name":"Plasmium Phial","type":"Red Tool","location":"Wormways","description":"Complete Alchemist's Assistant wish","act":"Act 1","prerequisites":[]},{"id":73,"name":"Voltvessels","type":"Red Tool","location":"Memorium","description":"Secret room with colored glass","act":"Act 1","prerequisites":[]},{"id":74,"name":"Rosary Cannon","type":"Red Tool","location":"High Halls","description":"Destroy ceiling lever","act":"Act 1","prerequisites":[]},{"id":75,"name":"Druid's Eye","type":"Blue Tool","location":"Mosshome","description":"Complete Berry Picking quest","act":"Act 1","prerequisites":[]},{"id":76,"name":"Druid's Eyes","type":"Blue Tool","location":"Mosshome","description":"Give 4 more Mossberries to Moss Druid","act":"Act 1","prerequisites":[]},{"id":77,"name":"Magma Bell","type":"Blue Tool","location":"Deep Docks","description":"Buy from Forge Daughter (110 Rosaries + Craftmetal)","act":"Act 1","prerequisites":[]},{"id":78,"name":"Fractured Mask","type":"Blue Tool","location":"Hunter's March","description":"Buy from Mottled Skarr (260 Rosaries)","act":"Act 1","prerequisites":[]},{"id":79,"name":"Pollip Pouch","type":"Blue Tool","location":"Shellwood","description":"Complete Rite of the Pollip quest","act":"Act 1","prerequisites":[]},{"id":80,"name":"Warding Bell","type":"Blue Tool","location":"Far Fields","description":"Secret passage (requires Drifter's Cloak)","act":"Act 1","prerequisites":["Drifter's Cloak"]},{"id":81,"name":"Multibinder","type":"Blue Tool","location":"Bellhart","description":"Buy from Frey (880 Rosaries, Act 2+)","act":"Act 1","prerequisites":[]},{"id":82,"name":"Weavelight","type":"Blue Tool","location":"Weavenest Atla","description":"Drops after defeating Moss Mother","act":"Act 1","prerequisites":[]},{"id":83,"name":"Sawtooth Circlet","type":"Blue Tool","location":"Underworks","description":"Buy from Twelfth Architect (230 Rosaries)","act":"Act 1","prerequisites":[]},{"id":84,"name":"Reserve Bind","type":"Blue Tool","location":"High Halls","description":"Defeat Second Sentinel","act":"Act 1","prerequisites":[]},{"id":85,"name":"Spool Extender","type":"Blue Tool","location":"Choral Chambers","description":"Buy from Jubilana (720 Rosaries)","act":"Act 1","prerequisites":[]},{"id":86,"name":"Injector Band","type":"Blue Tool","location":"Whiteward","description":"Found on shelf near Sherma","act":"Act 1","prerequisites":[]},{"id":87,"name":"Claw Mirror","type":"Blue Tool","location":"Whispering Vaults","description":"Defeat Trobbio at The Stage","act":"Act 1","prerequisites":[]},{"id":88,"name":"Claw Mirrors","type":"Blue Tool","location":"Whispering Vaults","description":"Combine Claw Mirror + Dark Mirror (Act 3)","act":"Act 3","prerequisites":[]},{"id":89,"name":"Memory Crystal","type":"Blue Tool","location":"Mount Fay","description":"Break ice shards, find in wide room","act":"Act 1","prerequisites":[]},{"id":90,"name":"Quick Sling","type":"Blue Tool","location":"Bilewater","description":"Secret area above Shakra's room","act":"Act 1","prerequisites":[]},{"id":91,"name":"Volt Filament","type":"Blue Tool","location":"Sands of Karak","description":"Defeat Voltvyrm boss","act":"Act 1","prerequisites":["Silk Soar","Cling Grip"]},{"id":92,"name":"Snitch Pick","type":"Blue Tool","location":"Blasted Steps","description":"Buy from Grindle (740 Rosaries, Act 3)","act":"Act 3","prerequisites":[]},{"id":93,"name":"Wreath of Purity","type":"Blue Tool","location":"Putrified Ducts","description":"Hidden passage east section","act":"Act 1","prerequisites":[]},{"id":94,"name":"Longclaw","type":"Blue Tool","location":"Bilewater","description":"Complete Broodfeast wish in Putrified Ducts","act":"Act 1","prerequisites":[]},{"id":95,"name":"Wispfire Lantern","type":"Blue Tool","location":"Underworks","description":"Defeat Father of Flame boss","act":"Act 1","prerequisites":[]},{"id":96,"name":"Pin Badge","type":"Blue Tool","location":"Mount Fay","description":"Defeat Pinstress boss","act":"Act 1","prerequisites":[]},{"id":97,"name":"Egg of Flealia","type":"Blue Tool","location":"Fleatopia","description":"Collect all 29 Lost Fleas","act":"Act 1","prerequisites":[]},{"id":98,"name":"Compass","type":"Yellow Tool","location":"The Marrow","description":"Buy from Shakra (70 Rosaries)","act":"Act 1","prerequisites":[]},{"id":99,"name":"Shard Pendant","type":"Yellow Tool","location":"The Marrow","description":"Room left of collapsing platforms","act":"Act 1","prerequisites":[]},{"id":100,"name":"Magnetite Brooch","type":"Yellow Tool","location":"Bone Bottom","description":"Buy from Pebb (120 Rosaries)","act":"Act 1","prerequisites":[]},{"id":101,"name":"Dead Bug's Purse","type":"Yellow Tool","location":"Wormways","description":"Found in dead bug body","act":"Act 1","prerequisites":[]},{"id":102,"name":"Barbed Bracelet","type":"Yellow Tool","location":"Sinner's Road","description":"Lowest section, southeast platform","act":"Act 1","prerequisites":[]},{"id":103,"name":"Weighted Belt","type":"Yellow Tool","location":"Far Fields","description":"Buy from Mort (160 Rosaries, Pilgrim's Rest)","act":"Act 1","prerequisites":[]},{"id":104,"name":"Shell Satchel","type":"Yellow Tool","location":"Bellhart","description":"Buy from Frey (520 Rosaries)","act":"","prerequisites":[]},{"id":105,"name":"Magnetite Dice","type":"Yellow Tool","location":"Bone Bottom","description":"Buy from Pebb (80 Rosaries)","act":"","prerequisites":[]},{"id":106,"name":"Scuttlebrace","type":"Yellow Tool","location":"Wormways","description":"Purchase location","act":"","prerequisites":[]},{"id":107,"name":"Silkspeed Anklets","type":"Yellow Tool","location":"The Marrow","description":"Purchase from Shakra","act":"","prerequisites":[]},{"id":108,"name":"Spider Strings","type":"Yellow Tool","location":"Greymoor","description":"Location unlocked later","act":"","prerequisites":["Needolin"]},{"id":109,"name":"Ascendant's Grip","type":"Yellow Tool","location":"Shellwood","description":"Purchase from merchant","act":"","prerequisites":[]},{"id":110,"name":"Thief's Mark","type":"Yellow Tool","location":"Sinner's Road","description":"Purchase location","act":"","prerequisites":[]},{"id":111,"name":"Silkspear","type":"Silk Skill","location":"Mosshome","description":"Top of large room outside Moss Druid cave","act":"","prerequisites":[]},{"id":112,"name":"Thread Storm","type":"Silk Skill","location":"Greymoor","description":"Halfway Home area - ascend chains with balloons","act":"","prerequisites":[]},{"id":113,"name":"Cross Stitch","type":"Silk Skill","location":"Exhaust Organ","description":"Defeat Phantom boss","act":"","prerequisites":[]},{"id":114,"name":"Sharpdart","type":"Silk Skill","location":"Wormways","description":"Requires Needolin and Clawline","act":"","prerequisites":["Needolin","Clawline"]},{"id":115,"name":"Rune Rage","type":"Silk Skill","location":"The Slab","description":"Defeat First Sinner","act":"","prerequisites":[]},{"id":116,"name":"Pale Nails","type":"Silk Skill","location":"The Cradle","description":"Defeat Grand Mother Silk, bind her arm (Act 3)","act":"Act 3","prerequisites":["Silk Soar"]},{"id":117,"name":"Reaper Crest","type":"Crest","location":"Greymoor","description":"Chapel of the Reaper - far left section","act":"","prerequisites":[]},{"id":118,"name":"Wanderer Crest","type":"Crest","location":"Far Fields","description":"Chapel of the Wanderer","act":"","prerequisites":[]},{"id":119,"name":"Beast Crest","type":"Crest","location":"Hunter's March","description":"Chapel of the Beast","act":"","prerequisites":[]},{"id":120,"name":"Witch Crest","type":"Crest","location":"Greymoor","description":"Chapel of the Witch","act":"Act 2","prerequisites":["Clawline"]},{"id":121,"name":"Architect Crest","type":"Crest","location":"Underworks","description":"Chapel of the Architect","act":"","prerequisites":[]},{"id":122,"name":"Shaman Crest","type":"Crest","location":"Moss Grotto","description":"Ruined Chapel - break through walls","act":"Act 3","prerequisites":["Silk Soar"]},{"id":123,"name":"Lost Flea #1","type":"Lost Flea","location":"The Marrow","description":"Top of vertical chamber after accepting quest","act":"","prerequisites":[]},{"id":124,"name":"Lost Flea #2","type":"Lost Flea","location":"Hunter's March","description":"Vertical section with red bud flowers","act":"","prerequisites":[]},{"id":125,"name":"Lost Flea #3","type":"Lost Flea","location":"Deep Docks","description":"Secret chamber with lava","act":"","prerequisites":[]},{"id":126,"name":"Lost Flea #4","type":"Lost Flea","location":"Deep Docks","description":"Northeast of first bench","act":"","prerequisites":["Swift Step","Drifter's Cloak"]},{"id":127,"name":"Lost Flea #5","type":"Lost Flea","location":"Deep Docks","description":"Requires Clawline","act":"","prerequisites":["Clawline","Cling Grip","Swift Step"]},{"id":128,"name":"Lost Flea #6","type":"Lost Flea","location":"Far Fields","description":"Behind cracked wall in secret room","act":"","prerequisites":[]},{"id":129,"name":"Lost Flea #7","type":"Lost Flea","location":"Far Fields","description":"Requires Drifter's Cloak and Cling Grip","act":"","prerequisites":["Drifter's Cloak","Cling Grip"]},{"id":130,"name":"Lost Flea #8","type":"Lost Flea","location":"Craw Lake","description":"Narrow platforms in upper right area","act":"","prerequisites":[]},{"id":131,"name":"Lost Flea #9","type":"Lost Flea","location":"Greymoor","description":"Top of tower in observation niche","act":"","prerequisites":[]},{"id":132,"name":"Lost Flea #10","type":"Lost Flea","location":"Bellhart","description":"Behind cracked wall via bouncing off blue bells","act":"","prerequisites":[]},{"id":133,"name":"Lost Flea #11","type":"Lost Flea","location":"Bilewater","description":"Hidden area in Exhaust Organ","act":"","prerequisites":["Cling Grip","Drifter's Cloak","Swift Step"]},{"id":134,"name":"Lost Flea #12","type":"Lost Flea","location":"Blasted Steps","description":"On ledge beside stone pillar (requires Faydown Cloak)","act":"","prerequisites":["Faydown Cloak"]},{"id":135,"name":"Lost Flea #13","type":"Lost Flea","location":"Choral Chambers","description":"Citadel area, requires multiple abilities","act":"","prerequisites":["Cling Grip","Faydown Cloak","Drifter's Cloak","Swift Step"]},{"id":136,"name":"Lost Flea #14","type":"Lost Flea","location":"Choral Chambers","description":"Citadel area, second location","act":"","prerequisites":["Drifter's Cloak"]},{"id":137,"name":"Lost Flea #15","type":"Lost Flea","location":"Memorium","description":"Huge Flea requiring combat at top","act":"","prerequisites":["Faydown Cloak","Cling Grip","Swift Step","Drifter's Cloak","Clawline"]},{"id":138,"name":"Lost Flea #16","type":"Lost Flea","location":"Mount Fay","description":"Accessible by climbing left wall","act":"","prerequisites":[]},{"id":139,"name":"Lost Flea #17","type":"Lost Flea","location":"Sands of Karak","description":"After parkour sequences and enemies","act":"","prerequisites":[]},{"id":140,"name":"Lost Flea #18","type":"Lost Flea","location":"Shellwood","description":"Trapped in vines at far bottom-right","act":"","prerequisites":["Faydown Cloak","Drifter's Cloak","Cling Grip"]},{"id":141,"name":"Lost Flea #19","type":"Lost Flea","location":"Sinner's Road","description":"Behind hanging cages in secret path","act":"","prerequisites":[]},{"id":142,"name":"Lost Flea #20","type":"Lost Flea","location":"Songclave","description":"Through Whispering Vaults, complex platforming","act":"","prerequisites":["Clawline"]},{"id":143,"name":"Lost Flea #21","type":"Lost Flea","location":"The Slab","description":"In round entrance","act":"","prerequisites":[]},{"id":144,"name":"Lost Flea #22","type":"Lost Flea","location":"The Slab","description":"Near Bellway Bench","act":"","prerequisites":["Cling Grip"]},{"id":145,"name":"Lost Flea #23","type":"Lost Flea","location":"Underworks","description":"The Cauldron area, lava floor platform","act":"","prerequisites":[]},{"id":146,"name":"Lost Flea #24","type":"Lost Flea","location":"Whispering Vaults","description":"Requires manipulating moving cube platforms","act":"","prerequisites":["Clawline","Cling Grip","Faydown Cloak","Swift Step"]},{"id":147,"name":"Lost Flea #25","type":"Lost Flea","location":"Wisp Thicket","description":"Trapped in cement at peak, multiple abilities","act":"","prerequisites":["Clawline","Faydown Cloak","Cling Grip"]},{"id":148,"name":"Lost Flea #26","type":"Lost Flea","location":"Wormways","description":"Requires breaking wall and defeating enemy","act":"","prerequisites":["Clawline","Drifter's Cloak","Faydown Cloak","Cling Grip"]},{"id":149,"name":"Lost Flea #27","type":"Lost Flea","location":"Putrified Ducts","description":"Vog in Pale Lake, requires vine climbing","act":"","prerequisites":["Clawline","Cling Grip","Faydown Cloak"]},{"id":150,"name":"Lost Flea #28","type":"Lost Flea","location":"Bilewater","description":"Additional location in area","act":"","prerequisites":[]},{"id":151,"name":"Lost Flea #29","type":"Lost Flea","location":"Bilewater","description":"Additional location in area","act":"","prerequisites":[]},{"id":152,"name":"Mister Mushroom #1","type":"Mister Mushroom","location":"Moss Grotto","description":"Initial location, start Passing of the Age quest","act":"","prerequisites":["Needolin"]},{"id":153,"name":"Mister Mushroom #2","type":"Mister Mushroom","location":"Bone Bottom","description":"Requires Needolin to draw out","act":"","prerequisites":["Silk Soar","Cling Grip","Clawline","Needolin"]},{"id":154,"name":"Mister Mushroom #3","type":"Mister Mushroom","location":"Far Fields","description":"Requires Needolin to draw out","act":"","prerequisites":["Silk Soar","Cling Grip","Clawline","Needolin"]},{"id":155,"name":"Mister Mushroom #4","type":"Mister Mushroom","location":"Greymoor","description":"Requires Needolin to draw out","act":"","prerequisites":["Silk Soar","Cling Grip","Clawline","Needolin"]},{"id":156,"name":"Mister Mushroom #5","type":"Mister Mushroom","location":"The Slab","description":"Requires Needolin to draw out","act":"","prerequisites":["Silk Soar","Cling Grip","Clawline","Needolin"]},{"id":157,"name":"Mister Mushroom #6","type":"Mister Mushroom","location":"Mount Fay","description":"Requires Silk Soar, Cling Grip, Clawline","act":"","prerequisites":["Silk Soar","Cling Grip","Clawline","Needolin"]},{"id":158,"name":"Mister Mushroom #7","type":"Mister Mushroom","location":"The Cradle","description":"Requires Silk Soar, Cling Grip, Clawline","act":"","prerequisites":["Silk Soar","Cling Grip","Clawline","Needolin"]}],
                loading: false,

                init() {
                    this.loadFromLocalStorage();
                },

                get uniqueActs() {
                    const acts = [...new Set(this.items.map(item => item.act).filter(act => act))];
                    return acts.sort();
                },

                get uniquePrerequisites() {
                    const prereqs = new Set();
                    this.items.forEach(item => {
                        if (item.prerequisites) {
                            item.prerequisites.forEach(p => prereqs.add(p));
                        }
                    });
                    return [...prereqs].sort();
                },

                get filteredItems() {
                    let filtered = this.items;

                    // Search filter
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(item =>
                            item.name.toLowerCase().includes(query) ||
                            item.location.toLowerCase().includes(query) ||
                            item.description.toLowerCase().includes(query)
                        );
                    }

                    // Type filter
                    if (this.filterType) {
                        filtered = filtered.filter(item => item.type === this.filterType);
                    }

                    // Location filter
                    if (this.filterLocation) {
                        filtered = filtered.filter(item => item.location === this.filterLocation);
                    }

                    // Act filter
                    if (this.filterAct) {
                        filtered = filtered.filter(item => item.act === this.filterAct);
                    }

                    // Prerequisites filter - show items you can complete with selected abilities
                    if (this.filterPrerequisites.length > 0) {
                        filtered = filtered.filter(item => {
                            // Items with no prerequisites can always be completed
                            if (!item.prerequisites || item.prerequisites.length === 0) {
                                return true;
                            }
                            // Check if all of the item's prerequisites are in the selected abilities
                            return item.prerequisites.every(prereq => this.filterPrerequisites.includes(prereq));
                        });
                    }

                    // Hide completed filter
                    if (this.hideCompleted) {
                        filtered = filtered.filter(item => !item.completed);
                    }

                    // Sort
                    filtered.sort((a, b) => {
                        let aVal = a[this.sortField];
                        let bVal = b[this.sortField];

                        if (typeof aVal === 'string') {
                            aVal = aVal.toLowerCase();
                            bVal = bVal.toLowerCase();
                        }

                        if (this.sortDirection === 'asc') {
                            return aVal > bVal ? 1 : -1;
                        } else {
                            return aVal < bVal ? 1 : -1;
                        }
                    });

                    // Add wiki and map URLs
                    filtered.forEach(item => {
                        item.wikiUrl = this.getWikiUrl(item);
                        item.mapUrl = this.getMapUrl(item);
                    });

                    return filtered;
                },

                get uniqueLocations() {
                    const locations = [...new Set(this.items.map(item => item.location))];
                    return locations.sort();
                },

                get completedCount() {
                    return this.items.filter(item => item.completed).length;
                },

                get totalItems() {
                    return this.items.length;
                },

                get progressPercentage() {
                    return Math.round((this.completedCount / this.totalItems) * 100);
                },

                sortBy(field) {
                    if (this.sortField === field) {
                        this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        this.sortField = field;
                        this.sortDirection = 'asc';
                    }
                },

                toggleItem(id, checked) {
                    const item = this.items.find(i => i.id === id);
                    if (item) {
                        item.completed = checked;
                        this.saveToLocalStorage();
                    }
                },

                getWikiUrl(item) {
                    // Lost Fleas all go to the collective Flea page
                    if (item.type === 'Lost Flea') {
                        return 'https://hollowknight.wiki/w/Flea';
                    }

                    // Mister Mushroom locations all go to the Mister Mushroom (Silksong) page
                    if (item.type === 'Mister Mushroom') {
                        return 'https://hollowknight.wiki/w/Mister_Mushroom_(Silksong)';
                    }

                    // For all other items, create individual page URLs
                    // Remove any "#N" suffixes (e.g., "Lost Flea #1" -> "Lost Flea")
                    let pageName = item.name.replace(/#\d+/, '').trim();

                    // Remove parenthetical suffixes (e.g., "Silkshot (Twelfth Architect)" -> "Silkshot")
                    pageName = pageName.replace(/\s*\([^)]+\)\s*/, '').trim();

                    // Convert to proper title case for wiki URLs
                    // Articles and prepositions should be lowercase when not at the start
                    const words = pageName.split(' ');
                    const lowercaseWords = ['the', 'of', 'and', 'at', 'in', 'to', 'a', 'an'];

                    pageName = words.map((word, index) => {
                        // Keep first word capitalized regardless
                        if (index === 0) return word;

                        // Lowercase articles and prepositions in the middle
                        if (lowercaseWords.includes(word.toLowerCase())) {
                            return word.toLowerCase();
                        }

                        return word;
                    }).join('_');

                    // Return the wiki URL
                    return `https://hollowknight.wiki/w/${pageName}`;
                },

                getMapUrl(item) {
                    const mapIds = {
                        // Bosses
                        'Widow': '151',
                        'Groal The Great': '236',
                        'Phantom': '230',
                        'Great Conchflies': '321',
                        'Last Judge': '326',
                        'Lost Garmond': '469',
                        'Cogwork Dancers': '458',
                        'Forebrothers Signis and Gron': '290',
                        'Lace': '146',
                        'Fourth Chorus': '147',
                        'Gurr the Outcast': '443',
                        'Lost Skarrgard': '1036',
                        'Savage Beastfly': '149',
                        'Skarrsinger Karmelita': '512',
                        'Rhinogrund': '414',
                        'Crawfather': '444',
                        'Moorwing': '150',
                        'Shakra': '24',
                        'Second Sentinel': '882',
                        'Lost Moss Mother': '935',
                        'Moss Mother': '34',
                        'Summoned Saviour': '34',
                        'Pinstress': '101',
                        'Crust King Khann': '467',
                        'Raging Conchfly': '466',
                        'Voltvyrm': '465',
                        'Watcher at the Edge': '468',
                        'Nyleth': '470',
                        'Seth': '471',
                        'Sister Splinter': '152',
                        'Disgraced Chef Lugoli': '450',
                        'Lost Lace': '442',
                        'Grand Mother Silk': '461',
                        'Bell Beast': '57',
                        'Skarrgard': '153',
                        'Skull Tyrant': '145',
                        'Broodmother': '463',
                        'First Sinner': '462',
                        'Clover Dancers': '447',
                        'Palestag': '446',
                        'Garmond and Zaza': '496',
                        'Tormented Trobbio': '457',
                        'Trobbio': '245',
                        'Father of the Flame': '472',
                        'The Unravelled': '473',
                        'Plasmified Zango': '690',
                        // Mini-Bosses
                        'Choir Clapper': '883',
                        'Craggler': '154',
                        // Red Tools
                        'Straight Pin': '171',
                        'Threefold Pin': '341',
                        'Sting Shard': '517',
                        'Curveclaw': '536',
                        'Longpin': '495',
                        'Tacks': '603',
                        'Curvesickle': '544',
                        'Throwing Ring': '348',
                        'Pimpillo': '492',
                        'Silkshot (Twelfth Architect)': '627',
                        'Silkshot (Forge Daughter)': '593',
                        'Conchcutter': '566',
                        'Silkshot': '626',
                        "Delver's Drill": '579',
                        'Cogwork Wheel': '575',
                        'Snare Setter': '375',
                        'Flintslate': '279',
                        'Cogfly': '589',
                        'Needle Phial': '525',
                        'Flea Brew': '330',
                        'Plasmium Phial': '527',
                        'Voltvessels': '586',
                        'Rosary Cannon': '587',
                        // Blue Tools
                        "Druid's Eye": '361',
                        "Druid's Eyes": '914',
                        'Magma Bell': '518',
                        'Fractured Mask': '534',
                        'Pollip Pouch': '502',
                        'Warding Bell': '256',
                        'Multibinder': '560',
                        'Weavelight': '371',
                        'Sawtooth Circlet': '573',
                        'Reserve Bind': '588',
                        'Spool Extender': '584',
                        'Injector Band': '298',
                        'Claw Mirror': '590',
                        'Claw Mirrors': '592',
                        'Memory Crystal': '605',
                        'Quick Sling': '233',
                        'Volt Filament': '567',
                        'Snitch Pick': '564',
                        'Wreath of Purity': '599',
                        'Longclaw': '597',
                        'Wispfire Lantern': '561',
                        'Pin Badge': '972',
                        'Egg of Flealia': '600',
                        // Yellow Tools
                        'Compass': '514',
                        'Shard Pendant': '56',
                        'Magnetite Brooch': '515',
                        "Dead Bug's Purse": '493',
                        'Barbed Bracelet': '604',
                        'Weighted Belt': '545',
                        'Shell Satchel': '586',
                        'Magnetite Dice': '515',
                        'Scuttlebrace': '493',
                        'Silkspeed Anklets': '514',
                        'Spider Strings': '341',
                        "Ascendant's Grip": '502',
                        "Thief's Mark": '603',
                        // Silk Skills
                        'Silkspear': '123',
                        'Thread Storm': '343',
                        'Cross Stitch': '249',
                        'Sharpdart': '583',
                        'Rune Rage': '571',
                        'Pale Nails': '580',
                        // Lost Fleas
                        'Lost Flea #1': '160',
                        'Lost Flea #2': '167',
                        'Lost Flea #3': '165',
                        'Lost Flea #4': '166',
                        'Lost Flea #5': '280',
                        'Lost Flea #6': '162',
                        'Lost Flea #7': '377',
                        'Lost Flea #8': '306',
                        'Lost Flea #9': '305',
                        'Lost Flea #10': '304',
                        'Lost Flea #11': '227',
                        'Lost Flea #12': '302',
                        'Lost Flea #13': '299',
                        'Lost Flea #14': '381',
                        'Lost Flea #15': '384',
                        'Lost Flea #16': '380',
                        'Lost Flea #17': '379',
                        'Lost Flea #18': '303',
                        'Lost Flea #19': '307',
                        'Lost Flea #20': '383',
                        'Lost Flea #21': '300',
                        'Lost Flea #22': '301',
                        'Lost Flea #23': '283',
                        'Lost Flea #24': '248',
                        'Lost Flea #25': '382',
                        'Lost Flea #26': '378',
                        'Lost Flea #27': '445',
                        'Lost Flea #28': '234',
                        'Lost Flea #29': '231',
                        // Mister Mushroom
                        'Mister Mushroom #1': '445',
                        'Mister Mushroom #2': '448',
                        'Mister Mushroom #3': '449',
                        'Mister Mushroom #4': '451',
                        'Mister Mushroom #5': '452',
                        'Mister Mushroom #6': '453',
                        'Mister Mushroom #7': '454',
                        // Crests
                        'Reaper Crest': '332',
                        'Wanderer Crest': '357',
                        'Beast Crest': '480',
                        'Witch Crest': '475',
                        'Architect Crest': '271',
                        'Shaman Crest': '474'
                    };

                    // Handle special cases where same name appears in multiple locations
                    if (item.name === 'Rhinogrund' && item.location === 'Memorium') {
                        return `https://hollowknightsilksong.wiki.fextralife.com/Interactive+Map?id=903&code=mapA`;
                    }
                    if (item.name === 'Lace' && item.location === 'The Cradle') {
                        return `https://hollowknightsilksong.wiki.fextralife.com/Interactive+Map?id=460&code=mapA`;
                    }

                    const mapId = mapIds[item.name];
                    if (mapId) {
                        return `https://hollowknightsilksong.wiki.fextralife.com/Interactive+Map?id=${mapId}&code=mapA`;
                    }

                    // Default for items without specific map coordinates (only Hunter Crest)
                    return `https://hollowknightsilksong.wiki.fextralife.com/Interactive+Map`;
                },

                saveToLocalStorage() {
                    const state = {
                        items: this.items.map(item => ({
                            id: item.id,
                            completed: item.completed
                        })),
                        filterPrerequisites: this.filterPrerequisites
                    };
                    localStorage.setItem('silksongChecklist', JSON.stringify(state));
                },

                loadFromLocalStorage() {
                    const saved = localStorage.getItem('silksongChecklist');
                    if (saved) {
                        try {
                            const state = JSON.parse(saved);

                            // Handle both old format (array) and new format (object)
                            if (Array.isArray(state)) {
                                // Old format - just completion data
                                state.forEach(savedItem => {
                                    const item = this.items.find(i => i.id === savedItem.id);
                                    if (item) {
                                        item.completed = savedItem.completed;
                                    }
                                });
                            } else {
                                // New format - has items and filterPrerequisites
                                if (state.items) {
                                    state.items.forEach(savedItem => {
                                        const item = this.items.find(i => i.id === savedItem.id);
                                        if (item) {
                                            item.completed = savedItem.completed;
                                        }
                                    });
                                }
                                if (state.filterPrerequisites) {
                                    this.filterPrerequisites = state.filterPrerequisites;
                                }
                            }
                        } catch (error) {
                            console.error('Error loading from localStorage:', error);
                        }
                    }
                },

                exportData() {
                    const dataStr = JSON.stringify(this.items, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'silksong-checklist-export.json';
                    link.click();
                    URL.revokeObjectURL(url);
                },

                importData(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const imported = JSON.parse(e.target.result);
                                imported.forEach(importedItem => {
                                    const item = this.items.find(i => i.id === importedItem.id);
                                    if (item) {
                                        item.completed = importedItem.completed;
                                    }
                                });
                                this.saveToLocalStorage();
                                alert('Import successful!');
                            } catch (error) {
                                alert('Error importing file. Please check the file format.');
                            }
                        };
                        reader.readAsText(file);
                    }
                },

                resetAll() {
                    if (confirm('Are you sure you want to reset all progress? A backup will be automatically downloaded.')) {
                        // Export current progress before resetting
                        this.exportData();

                        // Reset all items
                        this.items.forEach(item => item.completed = false);
                        this.saveToLocalStorage();
                    }
                }
            };
        }
    </script>
</body>
</html>
